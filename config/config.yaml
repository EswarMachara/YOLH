# =============================================================================
# RefYOLO-Human Configuration
# =============================================================================
# Central configuration for dataset paths and runtime settings
# Works on: Local VS Code (CPU), Lightning AI Studio (GPU), Kaggle, Colab
# =============================================================================

dataset:
  # Directory containing all images (FULL dataset)
  images_dir: data/images

  # Path to COCO-format annotations JSON
  annotations_path: data/annotations.json


cache:
  # Directory for cached YOLO features (used by grounding training)
  features_dir: cache


models:
  # ---------------------------------------------------------------------------
  # BASE (pretrained) YOLO models
  # These are used ONLY if yolo.fine_tune = false
  # ---------------------------------------------------------------------------
  pose_model: yolo11n-pose.pt
  seg_model: yolo11n-seg.pt


# =============================================================================
# YOLO FINE-TUNING CONFIGURATION
# =============================================================================
# YOLO is fine-tuned ONLY to improve visual features.
# Grounding is the primary task, YOLO is a supporting component.
# =============================================================================
yolo:
  # ---------------------------------------------------------------------------
  # Large YOLO variants (used as starting point for fine-tuning)
  # ---------------------------------------------------------------------------
  pose_model: yolo11l-pose.pt
  seg_model: yolo11l-seg.pt

  # ---------------------------------------------------------------------------
  # Enable fine-tuning mode
  # ---------------------------------------------------------------------------
  fine_tune: true

  # ---------------------------------------------------------------------------
  # IMPORTANT:
  # Pose fine-tuning is ALREADY DONE (pose_best.pt exists)
  # We are NOW re-running SEG fine-tuning only.
  # The training script will:
  #   - Skip pose if pose_finetuned exists
  #   - Train seg model from scratch (from yolo11l-seg.pt)
  # ---------------------------------------------------------------------------

  # -------------------------
  # Training hyperparameters
  # -------------------------
  epochs: 10          # Reduced for Kaggle time limits (can be increased later)
  batch_size: 16
  img_size: 640
  learning_rate: 0.001
  weight_decay: 0.0005

  # ---------------------------------------------------------------------------
  # Output directory for fine-tuned YOLO models
  # ---------------------------------------------------------------------------
  output_dir: checkpoints/yolo_finetuned

  # ---------------------------------------------------------------------------
  # Fine-tuned weights
  # These paths are CRITICAL:
  # - pose_finetuned already exists
  # - seg_finetuned will be produced in this run
  # ---------------------------------------------------------------------------
  pose_finetuned: checkpoints/yolo_finetuned/pose_best.pt
  seg_finetuned: checkpoints/yolo_finetuned/seg_best.pt

  # ---------------------------------------------------------------------------
  # OPTIONAL SAFETY SWITCHES (commented, not removed)
  # Uncomment ONLY if you want to explicitly control training
  # ---------------------------------------------------------------------------

  # train_pose: false     # Explicitly skip pose fine-tuning
  # train_seg: true       # Explicitly enable seg fine-tuning


# =============================================================================
# GROUNDING TRAINING CONFIGURATION
# =============================================================================
training:
  device: cuda

  batch_size: 8
  num_epochs: 20
  num_workers: 0

  learning_rate: 1.0e-4
  weight_decay: 1.0e-4
  grad_clip_norm: 1.0

  # null = full dataset
  max_steps_per_epoch: null


# =============================================================================
# CHECKPOINT MANAGEMENT
# =============================================================================
checkpoints:
  save_dir: checkpoints
  save_every_epochs: 1
  keep_best: true


# =============================================================================
# RUNTIME SETTINGS
# =============================================================================
runtime:
  seed: 42
  deterministic: true

  # Mixed precision for grounding (YOLO AMP is handled internally)
  mixed_precision: false


# =============================================================================
# SAMPLE-LEVEL SPLITS (CRITICAL FOR GROUNDING)
# =============================================================================
# Split is done at SAMPLE LEVEL, not image level.
# A sample = (image_id, instance_id, caption)
# =============================================================================
splits:
  train: 0.8
  val: 0.1
  test: 0.1
  seed: 42


# =============================================================================
# OUTPUT ARTIFACTS
# =============================================================================
outputs:
  base_dir: outputs
  logs_dir: outputs/logs
  visualizations_dir: outputs/visualizations
  plots_dir: outputs/plots
  evaluation_dir: outputs/evaluation
